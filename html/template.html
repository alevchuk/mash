<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <!-- <script src="http://code.jquery.com/jquery-latest.min.js"></script> -->
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <style type="text/css">
    b  { font-weight: normal; position: relative}
    b  { padding: 2px; padding-left: 4px; padding-right: 4px }
    .s { white-space: pre; font-family: "Nimbus Mono L", monospace;}

   .ruler-mark {
     position: absolute;
     top: 0;
     right: 4px;
   }

   .method {
      margin: 4px;
      margin-left: 1em;  
      display: block;
    }

    #bottom-right-corner {
      border: 0; 

      vertical-align: bottom;
      position: fixed; right: 20px;
      top: auto; bottom: 20px;
    }

    #main-menu {
      position: absolute;
      bottom: 0;
      right: 0;

      letter-spacing: 0px; white-space: normal;
      background-color: white; border-color: green;
      border: 5px solid #999999; padding: 0.5em;

      display: none;
    }
   
    #plugin-menu { 
      position: absolute; bottom: 0;
      right: 30em; /* This will be adjusted by JavaScript */

      margin-right: 1em;
      letter-spacing: 0px; white-space: normal;
      background-color: white; border-color: green;
      border: 5px solid #999999; padding: 0.5em;

      width: 30em;

      display: none;
    }

    #plugin-menu-citation { font-style: italic }
    #plugin-menu-affiliation { font-size: small }
    #plugin-menu-description { margin-top: 0.5em }

    #close-plugin-menu {
      margin-top: 1px; margin-left: 1px;
      position: absolute; left: -12px; top: -12px;
     
      border: 2px solid #999999; padding: 1px;
    }

    %%CSS%%

  </style>
  <title>%%TITLE%%</title>
</head>
<body>

<h2 style="float: left">Sequence Alignment Scoring Hypertext Analyzer</h2>
<div style="float: left"><a href="http://github.com/alevchuk/sasha/">(R Source Code)</a></div>
<div style="clear: left"></div>
<h3>%%TITLE%%</h3>

<div id="msa-window">
%%MSA%%
</div>

<div id="bottom-right-corner">
  <div id="plugin-menu"
  ><button id="close-plugin-menu">&#x2a2f;</button
  ><h3 id="plugin-menu-title" style="margin-top: 0"
  >Plugin Menu</h3><div id="plugin-menu-citation"
  ></div><div id="plugin-menu-affiliation"
  ></div><div id="plugin-menu-description"
  ></div><ul id="plugin-menu-notes"
  ></ul><div id="plugin-menu-links"></div></div>

  <div id="main-menu"
  ><h3 style="margin-top: 0">Main Menu</h3><div
  style="white-space: nowrap">Scoring Methods:</div>
    <div id="method-selector"></div>
  </div>

</div>


<p style="margin-top: 2em;"></p> <!-- Spacing -->
<p>
  Generated on %%GEN_DATE%% <br />
  <a href="http://validator.w3.org/check?uri=referer&amp;ss=checked&amp;outline=checked"
    >Valid HTML5</a><br />
  <a href="http://jigsaw.w3.org/css-validator/check/referer"
    >Valid CSS</a>
</p>

<!-- Large Spacing on the Bottom for Scrolling freedom-->
<p style="margin-top: 30em;"></p>

<script>
function apply_method(webdata_dir, method_name) {
  $.get(webdata_dir + "/" + method_name + ".html", function(data) {
    $('#msa-window').html(data); 
  });

  // ## ## Too slow!
  // ## $.getJSON(method_name, function(data) {
  // ## 
  // ##   $.each(data.colors, function(k1, c) {
  // ##     $.each(c.positions, function(k2, p) {
  // ##       var residue = $('#seq' + p[0]).children().slice(p[1] - 1, p[2]);
  // ##       residue.css('color', c.color[0]);
  // ##       residue.css('background-color', c.color[1]);
  // ##     });
  // ##   });
  // ## });
}

function show_method_info(webdata_dir, method_name) {

  $('#plugin-menu').css('right', $('#main-menu').width() + 15);
  $('#plugin-menu-title').html(method_name.replace("\.coloring-scorer", ""));
  $.getJSON(webdata_dir + "/" + method_name + ".json", function(data) {
    $('#plugin-menu-citation').text(data.citation || "");
    $('#plugin-menu-affiliation').text(data.affiliations || "");
    $('#plugin-menu-description').text(data.description || "");

    $('#plugin-menu-notes').html("")
    if(typeof(data.notes) !== 'undefined')
      $.each(data.notes, function(index, value){
        $('#plugin-menu-notes').append(
           '<li id="plugin-menu-note-' + index + '"></li>'); 
        $('#plugin-menu-note-' + index).text(value);
      });

    $('#plugin-menu-links').html("")
    if(typeof(data.links) !== 'undefined')
      $.each(data.links, function(index, value){
        $('#plugin-menu-links').append(
           '<a id="plugin-menu-link-' + index + '" href="">TEST</a> '); 
        $('#plugin-menu-link-' + index).text(value[0]);
        $('#plugin-menu-link-' + index).attr('href', value[1]);
      });

  });
  $('#plugin-menu').show();
}


// Main

$('#close-plugin-menu').click(function() {$("#plugin-menu").hide()});

$.getJSON('%%JSON_MENU_FILE%%', function(data) {
  $.each(data.plugins, function(k1, method_name) {
    $('<button id="b' + k1 + '" class="method">' +
      method_name.replace("\.coloring-scorer", "") + '</button><div>'
     ).appendTo('#method-selector');

    $('#b' + k1).click(function () {
      show_method_info(data.webdata_dir, method_name);
      apply_method(data.webdata_dir, method_name);
    });

  });

  $('#main-menu').show();
});
</script>

</body>
</html>
